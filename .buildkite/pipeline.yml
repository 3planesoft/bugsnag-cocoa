steps:
  - label: macOS 10.15 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa
    concurrency: 3
    concurrency_group: cocoa-unit-tests
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "macOS"
    commands:
      - make bootstrap
      - make analyze test
    artifact_paths:
      - xcodebuild.log

  - label: macOS 10.13 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa-10.13
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "macOS"
    commands:
      - make bootstrap
      - make analyze test
    artifact_paths:
      - xcodebuild.log

  - label: iOS 14 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa-11
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "iOS"
      OS: "14.2"
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: iOS 13 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "iOS"
      OS: "13.7"
    concurrency: 3
    concurrency_group: cocoa-unit-tests
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: iOS 12 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "iOS"
      OS: "12.4"
    concurrency: 3
    concurrency_group: cocoa-unit-tests
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: iOS 11 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "iOS"
      OS: "11.4"
    concurrency: 3
    concurrency_group: cocoa-unit-tests
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: iOS 10 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa-10.14
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "iOS"
      OS: "10.3.1"
      DEVICE: "iPhone 5s"
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: iOS 9 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa-10.13
    env:
      LANG: "en_GB.UTF-8"
      PLATFORM: "iOS"
      OS: "9.3"
      DEVICE: "iPhone 5s"
    commands:
      - make bootstrap
      - TEST_CONFIGURATION=Debug make test
      - TEST_CONFIGURATION=Release make test
    artifact_paths:
      - xcodebuild.log

  - label: tvOS 14 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa-11
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "tvOS"
      OS: "14.0"
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: tvOS 13 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "tvOS"
      OS: "13.3"
    concurrency: 3
    concurrency_group: cocoa-unit-tests
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: tvOS 12 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "tvOS"
      OS: "12.4"
    concurrency: 3
    concurrency_group: cocoa-unit-tests
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: tvOS 11 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "tvOS"
      OS: "11.4"
    concurrency: 3
    concurrency_group: cocoa-unit-tests
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: tvOS 10 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa-10.14
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "tvOS"
      OS: "10.2"
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log

  - label: tvOS 9 unit tests
    timeout_in_minutes: 5
    agents:
      queue: opensource-mac-cocoa-10.13
    env:
      LANG: "en_GB.UTF-8"
      TEST_CONFIGURATION: "Debug"
      PLATFORM: "tvOS"
      OS: "9.2"
    commands:
      - make bootstrap
      - make test
    artifact_paths:
      - xcodebuild.log
